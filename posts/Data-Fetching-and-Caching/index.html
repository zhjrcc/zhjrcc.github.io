<!DOCTYPE html><html lang="zh-CN"><head><title>Data Fetching and Caching</title><meta name="referrer" content="no-referrer"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="icon" href="https://gitee.com/zhjrcc/blog-images/raw/master/favicon.ico?v=2"><link rel="stylesheet" href="/css/post.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="inner"><h1>Data Fetching and Caching</h1><div class="time">First published 2024-12-25</div><div class="updatedTime">Modified 2024-12-25</div><p class="backHome"><span></span><a href="/">Back</a><span>↶</span></p><meta name="referrer" content="no-referrer">

<p><img src="https://gitee.com/zhjrcc/blog-images/raw/master/20241225203624.png"></p>
<p>Next.js 提供了多种方法来获取数据，并根据你所构建的应用程序类型来决定是使用服务器端获取数据还是客户端获取数据。以下是对 Next.js 文档中关于数据获取的详细解释：</p>
<p>服务器端数据获取<br>Server Components: 大多数情况下，建议在 Server Components 中获取数据，因为这可以直接访问后端资源（如数据库），避免将敏感信息（如 API 密钥）暴露给客户端。服务器组件允许在同一环境中获取数据和渲染，减少客户端和服务器之间的通信，从而提高性能。你可以使用 fetch 函数直接在 Server Components 中获取数据，或者使用 ORM 或直接数据库查询。<br>Data Caching: Next.js 使用 Data Cache 来缓存 fetch 的返回值，默认情况下，这会使数据在下次请求时被重用。fetch 函数的缓存行为可以通过 cache 和 next.revalidate 选项来配置，例如：<br>js<br>fetch(‘https:&#x2F;&#x2F;…’, { cache: ‘force-cache’ })<br>fetch(‘https:&#x2F;&#x2F;…’, { next: { revalidate: 3600 } })<br>force-cache 强制使用缓存，revalidate 定义缓存的生命周期。<br>Incremental Static Regeneration (ISR): 允许在运行时生成或更新静态页面。如果在静态渲染的路由中使用了动态 API，Next.js 会进行自动的静态再生，确保数据的更新。你可以在 getStaticProps 中设置 revalidate 来实现定时更新。<br>Streaming: Next.js 支持通过 Suspense 和 loading.js 文件流式传输页面内容，这意味着用户可以立即看到页面的一部分，同时后台继续加载数据。</p>
<p>客户端数据获取<br>Client Components: 如果需要在客户端获取数据，可以使用第三方库如 SWR 或 TanStack Query。这些库提供了缓存、重新验证和数据突变的功能。对于客户端数据获取，通常使用 useEffect 钩子或这些库的 API 来管理数据请求。<br>Route Handlers: 对于需要在客户端调用但在服务器上执行的数据获取，可以使用 Route Handlers。这些处理程序可以直接在服务器上处理请求，返回数据给客户端，避免敏感信息暴露。</p>
<p>最佳实践<br>Parallel Data Fetching: 通过在组件外定义数据获取函数并在组件内调用，可以实现并行数据获取，避免数据获取的瀑布式延迟。<br>Preloading: 使用 preload 模式，可以在真正需要数据的组件之前开始数据获取，优化加载时间。<br>Suspense: 使用 React 的 Suspense 特性，可以实现渐进式渲染，部分内容在数据加载时显示加载状态。<br>Security: 任何需要在服务器上执行的操作，如处理敏感信息，都应避免在客户端组件中进行，确保数据安全。</p>
<p>注意点<br>Development vs Production: 在开发环境中，数据获取函数在每次请求时都会执行，但在生产环境中，数据会根据配置缓存。<br>Dynamic and Static: 需要根据应用的需求选择动态渲染还是静态生成。对于需要实时数据的场景，动态渲染可能更合适，而对于内容不经常变化的页面，静态生成和 ISR 可以改善性能和用户体验。</p>
<p>这些方法和技术结合使用，使得 Next.js 应用程序在性能、安全性和用户体验上都得到优化。</p>
<p class="backHome"><span></span><a href="/">Back</a><span>↶</span></p></div><script src="/js/highlight.min.js"></script><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>